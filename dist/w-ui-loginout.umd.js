/*!
 * w-ui-loginout v1.0.10
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("axios")):"function"==typeof define&&define.amd?define(["axios"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-ui-loginout"]=e(t.axios)}(this,(function(t){"use strict";var e=Array.isArray,r="object"==typeof global&&global&&global.Object===Object&&global,n="object"==typeof self&&self&&self.Object===Object&&self,o=r||n||Function("return this")(),i=o.Symbol,u=Object.prototype,a=u.hasOwnProperty,c=u.toString,l=i?i.toStringTag:void 0;var s=Object.prototype.toString;var f="[object Null]",p="[object Undefined]",h=i?i.toStringTag:void 0;function y(t){return null==t?void 0===t?p:f:h&&h in Object(t)?function(t){var e=a.call(t,l),r=t[l];try{t[l]=void 0;var n=!0}catch(t){}var o=c.call(t);return n&&(e?t[l]=r:delete t[l]),o}(t):function(t){return s.call(t)}(t)}function g(t){return null!=t&&"object"==typeof t}var v="[object Symbol]";function b(t){return"symbol"==typeof t||g(t)&&y(t)==v}var d=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,j=/^\w*$/;function m(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var _="[object AsyncFunction]",w="[object Function]",O="[object GeneratorFunction]",P="[object Proxy]";function x(t){if(!m(t))return!1;var e=y(t);return e==w||e==O||e==_||e==P}var $,S=o["__core-js_shared__"],k=($=/[^.]+$/.exec(S&&S.keys&&S.keys.IE_PROTO||""))?"Symbol(src)_1."+$:"";var T=Function.prototype.toString;var A=/^\[object .+?Constructor\]$/,N=Function.prototype,E=Object.prototype,F=N.toString,I=E.hasOwnProperty,z=RegExp("^"+F.call(I).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function U(t){return!(!m(t)||(e=t,k&&k in e))&&(x(t)?z:A).test(function(t){if(null!=t){try{return T.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function L(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return U(r)?r:void 0}var C=L(Object,"create");var G=Object.prototype.hasOwnProperty;var B=Object.prototype.hasOwnProperty;function M(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function R(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}M.prototype.clear=function(){this.__data__=C?C(null):{},this.size=0},M.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},M.prototype.get=function(t){var e=this.__data__;if(C){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return G.call(e,t)?e[t]:void 0},M.prototype.has=function(t){var e=this.__data__;return C?void 0!==e[t]:B.call(e,t)},M.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=C&&void 0===e?"__lodash_hash_undefined__":e,this};var V=Array.prototype.splice;function q(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}q.prototype.clear=function(){this.__data__=[],this.size=0},q.prototype.delete=function(t){var e=this.__data__,r=R(e,t);return!(r<0)&&(r==e.length-1?e.pop():V.call(e,r,1),--this.size,!0)},q.prototype.get=function(t){var e=this.__data__,r=R(e,t);return r<0?void 0:e[r][1]},q.prototype.has=function(t){return R(this.__data__,t)>-1},q.prototype.set=function(t,e){var r=this.__data__,n=R(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var D=L(o,"Map");function W(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function H(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}H.prototype.clear=function(){this.size=0,this.__data__={hash:new M,map:new(D||q),string:new M}},H.prototype.delete=function(t){var e=W(this,t).delete(t);return this.size-=e?1:0,e},H.prototype.get=function(t){return W(this,t).get(t)},H.prototype.has=function(t){return W(this,t).has(t)},H.prototype.set=function(t,e){var r=W(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var J="Expected a function";function K(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(J);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(K.Cache||H),r}K.Cache=H;var Q,X,Y,Z=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/\\(\\)?/g,et=(Q=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Z,(function(t,r,n,o){e.push(n?o.replace(tt,"$1"):r||t)})),e},X=K(Q,(function(t){return 500===Y.size&&Y.clear(),t})),Y=X.cache,X),rt=et;var nt=1/0,ot=i?i.prototype:void 0,it=ot?ot.toString:void 0;function ut(t){if("string"==typeof t)return t;if(e(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,ut)+"";if(b(t))return it?it.call(t):"";var r=t+"";return"0"==r&&1/t==-nt?"-0":r}function at(t){return null==t?"":ut(t)}function ct(t,r){return e(t)?t:function(t,r){if(e(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!b(t))||j.test(t)||!d.test(t)||null!=r&&t in Object(r)}(t,r)?[t]:rt(at(t))}var lt=1/0;function st(t){if("string"==typeof t||b(t))return t;var e=t+"";return"0"==e&&1/t==-lt?"-0":e}function ft(t,e,r){var n=null==t?void 0:function(t,e){for(var r=0,n=(e=ct(e,t)).length;null!=t&&r<n;)t=t[st(e[r++])];return r&&r==n?t:void 0}(t,e);return void 0===n?r:n}function pt(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}var ht,yt=function(t,e,r){for(var n=-1,o=Object(t),i=r(t),u=i.length;u--;){var a=i[ht?u:++n];if(!1===e(o[a],a,o))break}return t};function gt(t){return g(t)&&"[object Arguments]"==y(t)}var vt=Object.prototype,bt=vt.hasOwnProperty,dt=vt.propertyIsEnumerable,jt=gt(function(){return arguments}())?gt:function(t){return g(t)&&bt.call(t,"callee")&&!dt.call(t,"callee")},mt=jt;var _t="object"==typeof exports&&exports&&!exports.nodeType&&exports,wt=_t&&"object"==typeof module&&module&&!module.nodeType&&module,Ot=wt&&wt.exports===_t?o.Buffer:void 0,Pt=(Ot?Ot.isBuffer:void 0)||function(){return!1},xt=9007199254740991,$t=/^(?:0|[1-9]\d*)$/;function St(t,e){var r=typeof t;return!!(e=null==e?xt:e)&&("number"==r||"symbol"!=r&&$t.test(t))&&t>-1&&t%1==0&&t<e}var kt=9007199254740991;function Tt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=kt}var At={};At["[object Float32Array]"]=At["[object Float64Array]"]=At["[object Int8Array]"]=At["[object Int16Array]"]=At["[object Int32Array]"]=At["[object Uint8Array]"]=At["[object Uint8ClampedArray]"]=At["[object Uint16Array]"]=At["[object Uint32Array]"]=!0,At["[object Arguments]"]=At["[object Array]"]=At["[object ArrayBuffer]"]=At["[object Boolean]"]=At["[object DataView]"]=At["[object Date]"]=At["[object Error]"]=At["[object Function]"]=At["[object Map]"]=At["[object Number]"]=At["[object Object]"]=At["[object RegExp]"]=At["[object Set]"]=At["[object String]"]=At["[object WeakMap]"]=!1;var Nt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Et=Nt&&"object"==typeof module&&module&&!module.nodeType&&module,Ft=Et&&Et.exports===Nt&&r.process,It=function(){try{var t=Et&&Et.require&&Et.require("util").types;return t||Ft&&Ft.binding&&Ft.binding("util")}catch(t){}}(),zt=It&&It.isTypedArray,Ut=zt?function(t){return function(e){return t(e)}}(zt):function(t){return g(t)&&Tt(t.length)&&!!At[y(t)]},Lt=Ut,Ct=Object.prototype.hasOwnProperty;function Gt(t,r){var n=e(t),o=!n&&mt(t),i=!n&&!o&&Pt(t),u=!n&&!o&&!i&&Lt(t),a=n||o||i||u,c=a?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],l=c.length;for(var s in t)!r&&!Ct.call(t,s)||a&&("length"==s||i&&("offset"==s||"parent"==s)||u&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||St(s,l))||c.push(s);return c}var Bt=Object.prototype;var Mt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Rt=Mt,Vt=Object.prototype.hasOwnProperty;function qt(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||Bt))return Rt(t);var e,r,n=[];for(var o in Object(t))Vt.call(t,o)&&"constructor"!=o&&n.push(o);return n}function Dt(t){return null!=t&&Tt(t.length)&&!x(t)}function Wt(t){return Dt(t)?Gt(t):qt(t)}var Ht=function(t,e){return function(r,n){if(null==r)return r;if(!Dt(r))return t(r,n);for(var o=r.length,i=e?o:-1,u=Object(r);(e?i--:++i<o)&&!1!==n(u[i],i,u););return r}}((function(t,e){return t&&yt(t,e,Wt)})),Jt=Ht;function Kt(t){return t}function Qt(t,r){var n;return(e(t)?pt:Jt)(t,"function"==typeof(n=r)?n:Kt)}function Xt(t){return"[object String]"===Object.prototype.toString.call(t)}function Yt(t){return!(!Xt(t)||""===t)}function Zt(t){return"[object Array]"===Object.prototype.toString.call(t)}function te(t){return"[object Object]"===Object.prototype.toString.call(t)}function ee(t){return t!=t}function re(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(te(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!Xt(t)||""!==t)}(t)||(!!function(t){return!!Zt(t)&&0===t.length}(t)||!!ee(t)))))}function ne(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"anyone";if(!Yt(t))return!1;if("anyone"!==r&&"all"!==r)return!1;if(Xt(e)){if(!Yt(e))return!1;e=[e]}if(!Zt(n=e)||0===n.length||1===n.length&&re(n[0]))return!1;var n;let o=!1;if(Qt(e,(function(t){Yt(t)||(o=!0)})),o)return!1;let i=0;return Qt(e,(function(e){-1!==function(t,e){return t.indexOf(e)}(t,e)&&i++})),"anyone"===r?i>0:"all"===r&&i===e.length}var oe=/\s/;var ie=/^\s+/;function ue(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&oe.test(t.charAt(e)););return e}(t)+1).replace(ie,""):t}var ae=NaN,ce=/^[-+]0x[0-9a-f]+$/i,le=/^0b[01]+$/i,se=/^0o[0-7]+$/i,fe=parseInt;function pe(t){if("number"==typeof t)return t;if(b(t))return ae;if(m(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=m(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=ue(t);var r=le.test(t);return r||se.test(t)?fe(t.slice(2),r?2:8):ce.test(t)?ae:+t}var he=1/0,ye=17976931348623157e292;function ge(t){return t?(t=pe(t))===he||t===-he?(t<0?-1:1)*ye:t==t?t:0:0===t?t:0}function ve(t){var e=ge(t),r=e%1;return e==e?r?e-r:e:0}function be(t){let e=!1;if(Yt(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(ee(t))return!1;e=!0}return e}function de(t){if(!be(t))return 0;return ge(t)}function je(t){return!!be(t)&&(t=de(t),"number"==typeof(e=t)&&e==ve(e));var e}var me=o.isFinite,_e=Math.min;var we=function(t){var e=Math[t];return function(t,r){if(t=pe(t),(r=null==r?0:_e(ve(r),292))&&me(t)){var n=(at(t)+"e").split("e");return+((n=(at(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round"),Oe=we;function Pe(t){if(!be(t))return 0;t=de(t);let e=Oe(t);return"0"===String(e)?0:e}function xe(t){if(!je(t))return!1;return Pe(t)>0}function $e(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function Se(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}function ke(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}return function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Yt(e))throw new Error("invalid site");let n=ft(r,"params",{}),o=ft(r,"keyGlobal","");Yt(o)||(o="___params___");let i=ft(r,"timeWaitAnimation");xe(i)||(i=0);let u=ft(r,"defToken","");Yt(u)||(u="sys");let a=ft(r,"apiName","");Yt(a)||(a="api");let c=ft(r,"apiNameForVerify","");Yt(c)||(c="getUserByToken");let l=ft(r,"urlForVerify","");Yt(l)||(l="");let s=ft(r,"retry");var f;je(f=s)&&Pe(f)>=0||(s=3);let p=window.location.origin,h=window.location.origin+window.location.pathname,y=p,g=h;if(Yt(window.location.port)){let t=`:${window.location.port}`;y=y.replace(t,""),g=g.replace(t,"")}window[o]={...n,site:e,origin:p,originNoPort:y,base:h,baseNoPort:g};let v=()=>{let t=new URLSearchParams(window.location.search),e={};return t.forEach(((t,r)=>{e[r]=t})),e},b=()=>ft(v(),"token",""),d=()=>{let t="";return Yt(t)||(t=b()),Yt(t)||(t=localStorage.getItem(`${e}:userToken`)),t},j=t=>ft(window,`${o}.${t}`,""),m=t=>{let e=d(),r=ft(window,`${o}.origin`,""),n=ft(window,`${o}.originNoPort`,""),i=ft(window,`${o}.base`,""),u=ft(window,`${o}.baseNoPort`,""),a=j(t);return a=a.replace("{token}",e),a=a.replace("{origin}",r),a=a.replace("{originNoPort}",n),a=a.replace("{base}",i),a=a.replace("{baseNoPort}",u),a},_=async e=>{let r,n=null;return await t({method:"GET",url:e}).then((t=>{r=t.data})).catch((t=>{n=t.toString()})),null!==n?Promise.reject(n):r},w=async t=>{let e=j("base");return _(`${e}${a}/${t}`)},O={parseUrl:v,getTokenFromUrl:b,getToken:d,getValue:j,getUrl:m,getApi:w,login:async function(){let t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=ft(r,"afterGetUser"),o=ft(r,"afterLogin"),a=ft(r,"loginError"),s=ft(r,"loginSuccess"),f=j("site");await async function(){let t=null;if(await function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;be(t)||(t=10);let e=ke();return setTimeout((function(){e.resolve()}),t),e}(i),!Yt(f))throw console.log("site",f),new Error("invalid site");let e="";if(Yt(e)||(e=b()),Yt(e)||(e=localStorage.getItem(`${f}:userToken`)),location&&ne(location.href,"localhost")){if(Yt(e)||(e=u),"error"===e)return t={text:"登入時無效令牌",msg:"invalid token"},Promise.reject(t)}else if(!Yt(e))return t={text:"登入時無效令牌",msg:"invalid token"},Promise.reject(t);let r=null;r=Yt(l)?_(`${l}?token=${e}`):w(`${c}?token=${e}`);let o=await r.catch((e=>{t={text:"登入時無法連線",msg:e}}));if(null!==t)return Promise.reject(t);if("error"===ft(o,"state"))return t={text:"登入時驗證失敗",msg:ft(o,"msg")},Promise.reject(t);let a=ft(o,"msg");if(!function(t){if(te(t)){for(let e in t)return!0;return!1}return!1}(a))return console.log("data",o),t={text:"登入時無法取得使用者資訊",msg:"invalid user"},Promise.reject(t);if($e(n)){let t=n(a);Se(t)&&(t=await t)}return{token:e,user:a}}().then((r=>{t=!0,e=r,localStorage.setItem(`${f}:userToken`,r.token)})).catch((r=>{t=!1,e=r,localStorage.setItem(`${f}:userToken`,"")}));let p={state:t,data:e};if($e(o)){let t=o(p);Se(t)&&(t=await t)}if(t){if($e(s)){let t=s(e);Se(t)&&(t=await t)}}else if($e(a)){let t=a(e);Se(t)&&(t=await t)}return p},detect:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=ft(e,"timePeriod");xe(r)||(r=2e3),r=Pe(r);let n=ft(e,"procCheckToken"),o=ft(e,"procLogout"),i=j("site"),u=m("checkToken"),a=async()=>{let e=null,r=await t({method:"GET",url:u}).catch((t=>{e={text:"驗證令牌時遭遇錯誤",msg:t}}));return null!==e?Promise.reject(e):r},c=async()=>{let t=function(t){if(!$e(t))throw new Error("fn is not a function");return function(){let e=ke(),r=null,n=null;try{r=t.apply(this,arguments)}catch(t){n=t}return null!==n?e.resolve({state:"error",msg:n}):Se(r)?r.then((t=>{e.resolve({state:"success",msg:t})})).catch((t=>{"cancelled"===ft(t,"reason")?e.resolve({state:"cancelled",msg:""}):e.resolve({state:"error",msg:t})})):e.resolve({state:"success",msg:r}),e}}(a),e=await t(),r=0;for(;"error"===e.state&&(r+=1,!(r>s));)console.log(`retry n=${r}`),e=await t();return"success"===e.state?e.msg:Promise.reject(e.msg)},l=!1;let f=setInterval((()=>{(async function(){let t=null;if(l)return;if(l=!0,!Yt(localStorage.getItem(`${i}:userToken`)))return t={text:"令牌已清除",msg:"invalid token"},Promise.reject(t);let e=await c().catch((e=>{t=e}));if(null!==t)return Promise.reject(t);if($e(n)){let r=n(e);Se(r)&&(r=await r),r||(t={text:"驗證令牌失敗",msg:e})}if(null!==t)return Promise.reject(t);l=!1})().catch((t=>{clearInterval(f),$e(o)&&o(t)}))}),r);return null},logout:async function(){let e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=ft(n,"procLogout"),i=ft(n,"afterLogout"),u=ft(n,"logoutError"),a=ft(n,"logoutSuccess"),c=j("site");await async function(){let e=null,r=d();if(!Yt(r))return e={text:"無法取得登出用token",msg:"invalid token"},Promise.reject(e);let n=m("logOut");if(!Yt(n))return e={text:"無法取得登出用設定資訊",msg:"invalid urlLogOut"},Promise.reject(e);let i=await t({method:"GET",url:n}).catch((t=>{e={text:"登出時遭遇錯誤",msg:t}}));if(null!==e)return Promise.reject(e);if($e(o)){let t=o(i);Se(t)&&(t=await t),t||(e={text:"登出失敗",msg:i})}return null!==e?Promise.reject(e):{token:r}}().then((t=>{e=!0,r=t})).catch((t=>{e=!1,r=t}));let l={state:e,data:r};if(localStorage.setItem(`${c}:userToken`,""),$e(i)){let t=i(l);Se(t)&&(t=await t)}if(e){if($e(a)){let t=a(r);Se(t)&&(t=await t)}}else if($e(u)){let t=u(r);Se(t)&&(t=await t)}return l}};return O}}));
//# sourceMappingURL=w-ui-loginout.umd.js.map
