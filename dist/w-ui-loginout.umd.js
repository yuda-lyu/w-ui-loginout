/*!
 * w-ui-loginout v1.0.9
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("axios")):"function"==typeof define&&define.amd?define(["axios"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-ui-loginout"]=e(t.axios)}(this,(function(t){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"===e(r)?r:String(r)}function n(t,e,n){return(e=r(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var o=Array.isArray,i="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,c=i||u||Function("return this")(),a=c.Symbol,l=Object.prototype,f=l.hasOwnProperty,s=l.toString,p=a?a.toStringTag:void 0;var y=Object.prototype.toString;var b="[object Null]",h="[object Undefined]",g=a?a.toStringTag:void 0;function v(t){return null==t?void 0===t?h:b:g&&g in Object(t)?function(t){var e=f.call(t,p),r=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=s.call(t);return n&&(e?t[p]=r:delete t[p]),o}(t):function(t){return y.call(t)}(t)}function d(t){return null!=t&&"object"==typeof t}var j="[object Symbol]";function m(t){return"symbol"==typeof t||d(t)&&v(t)==j}var w=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,_=/^\w*$/;function O(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var P="[object AsyncFunction]",S="[object Function]",x="[object GeneratorFunction]",k="[object Proxy]";function $(t){if(!O(t))return!1;var e=v(t);return e==S||e==x||e==P||e==k}var T,A=c["__core-js_shared__"],E=(T=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"";var N=Function.prototype.toString;var F=/^\[object .+?Constructor\]$/,I=Function.prototype,z=Object.prototype,U=I.toString,L=z.hasOwnProperty,C=RegExp("^"+U.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function D(t){return!(!O(t)||(e=t,E&&E in e))&&($(t)?C:F).test(function(t){if(null!=t){try{return N.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}function G(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return D(r)?r:void 0}var B=G(Object,"create");var M=Object.prototype.hasOwnProperty;var R=Object.prototype.hasOwnProperty;function q(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}function V(t,e){for(var r,n,o=t.length;o--;)if((r=t[o][0])===(n=e)||r!=r&&n!=n)return o;return-1}q.prototype.clear=function(){this.__data__=B?B(null):{},this.size=0},q.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},q.prototype.get=function(t){var e=this.__data__;if(B){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return M.call(e,t)?e[t]:void 0},q.prototype.has=function(t){var e=this.__data__;return B?void 0!==e[t]:R.call(e,t)},q.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=B&&void 0===e?"__lodash_hash_undefined__":e,this};var W=Array.prototype.splice;function H(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}H.prototype.clear=function(){this.__data__=[],this.size=0},H.prototype.delete=function(t){var e=this.__data__,r=V(e,t);return!(r<0)&&(r==e.length-1?e.pop():W.call(e,r,1),--this.size,!0)},H.prototype.get=function(t){var e=this.__data__,r=V(e,t);return r<0?void 0:e[r][1]},H.prototype.has=function(t){return V(this.__data__,t)>-1},H.prototype.set=function(t,e){var r=this.__data__,n=V(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this};var J=G(c,"Map");function K(t,e){var r,n,o=t.__data__;return("string"==(n=typeof(r=e))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==r:null===r)?o["string"==typeof e?"string":"hash"]:o.map}function Q(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}Q.prototype.clear=function(){this.size=0,this.__data__={hash:new q,map:new(J||H),string:new q}},Q.prototype.delete=function(t){var e=K(this,t).delete(t);return this.size-=e?1:0,e},Q.prototype.get=function(t){return K(this,t).get(t)},Q.prototype.has=function(t){return K(this,t).has(t)},Q.prototype.set=function(t,e){var r=K(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this};var X="Expected a function";function Y(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(X);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(Y.Cache||Q),r}Y.Cache=Q;var Z,tt,et,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nt=/\\(\\)?/g,ot=(Z=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,r,n,o){e.push(n?o.replace(nt,"$1"):r||t)})),e},tt=Y(Z,(function(t){return 500===et.size&&et.clear(),t})),et=tt.cache,tt),it=ot;var ut=1/0,ct=a?a.prototype:void 0,at=ct?ct.toString:void 0;function lt(t){if("string"==typeof t)return t;if(o(t))return function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}(t,lt)+"";if(m(t))return at?at.call(t):"";var e=t+"";return"0"==e&&1/t==-ut?"-0":e}function ft(t){return null==t?"":lt(t)}function st(t,e){return o(t)?t:function(t,e){if(o(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!m(t))||_.test(t)||!w.test(t)||null!=e&&t in Object(e)}(t,e)?[t]:it(ft(t))}var pt=1/0;function yt(t){if("string"==typeof t||m(t))return t;var e=t+"";return"0"==e&&1/t==-pt?"-0":e}function bt(t,e,r){var n=null==t?void 0:function(t,e){for(var r=0,n=(e=st(e,t)).length;null!=t&&r<n;)t=t[yt(e[r++])];return r&&r==n?t:void 0}(t,e);return void 0===n?r:n}function ht(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}var gt,vt=function(t,e,r){for(var n=-1,o=Object(t),i=r(t),u=i.length;u--;){var c=i[gt?u:++n];if(!1===e(o[c],c,o))break}return t};function dt(t){return d(t)&&"[object Arguments]"==v(t)}var jt=Object.prototype,mt=jt.hasOwnProperty,wt=jt.propertyIsEnumerable,_t=dt(function(){return arguments}())?dt:function(t){return d(t)&&mt.call(t,"callee")&&!wt.call(t,"callee")},Ot=_t;var Pt="object"==typeof exports&&exports&&!exports.nodeType&&exports,St=Pt&&"object"==typeof module&&module&&!module.nodeType&&module,xt=St&&St.exports===Pt?c.Buffer:void 0,kt=(xt?xt.isBuffer:void 0)||function(){return!1},$t=9007199254740991,Tt=/^(?:0|[1-9]\d*)$/;function At(t,e){var r=typeof t;return!!(e=null==e?$t:e)&&("number"==r||"symbol"!=r&&Tt.test(t))&&t>-1&&t%1==0&&t<e}var Et=9007199254740991;function Nt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Et}var Ft={};Ft["[object Float32Array]"]=Ft["[object Float64Array]"]=Ft["[object Int8Array]"]=Ft["[object Int16Array]"]=Ft["[object Int32Array]"]=Ft["[object Uint8Array]"]=Ft["[object Uint8ClampedArray]"]=Ft["[object Uint16Array]"]=Ft["[object Uint32Array]"]=!0,Ft["[object Arguments]"]=Ft["[object Array]"]=Ft["[object ArrayBuffer]"]=Ft["[object Boolean]"]=Ft["[object DataView]"]=Ft["[object Date]"]=Ft["[object Error]"]=Ft["[object Function]"]=Ft["[object Map]"]=Ft["[object Number]"]=Ft["[object Object]"]=Ft["[object RegExp]"]=Ft["[object Set]"]=Ft["[object String]"]=Ft["[object WeakMap]"]=!1;var It="object"==typeof exports&&exports&&!exports.nodeType&&exports,zt=It&&"object"==typeof module&&module&&!module.nodeType&&module,Ut=zt&&zt.exports===It&&i.process,Lt=function(){try{var t=zt&&zt.require&&zt.require("util").types;return t||Ut&&Ut.binding&&Ut.binding("util")}catch(t){}}(),Ct=Lt&&Lt.isTypedArray,Dt=Ct?function(t){return function(e){return t(e)}}(Ct):function(t){return d(t)&&Nt(t.length)&&!!Ft[v(t)]},Gt=Dt,Bt=Object.prototype.hasOwnProperty;function Mt(t,e){var r=o(t),n=!r&&Ot(t),i=!r&&!n&&kt(t),u=!r&&!n&&!i&&Gt(t),c=r||n||i||u,a=c?function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n}(t.length,String):[],l=a.length;for(var f in t)!e&&!Bt.call(t,f)||c&&("length"==f||i&&("offset"==f||"parent"==f)||u&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||At(f,l))||a.push(f);return a}var Rt=Object.prototype;var qt=function(t,e){return function(r){return t(e(r))}}(Object.keys,Object),Vt=qt,Wt=Object.prototype.hasOwnProperty;function Ht(t){if(r=(e=t)&&e.constructor,e!==("function"==typeof r&&r.prototype||Rt))return Vt(t);var e,r,n=[];for(var o in Object(t))Wt.call(t,o)&&"constructor"!=o&&n.push(o);return n}function Jt(t){return null!=t&&Nt(t.length)&&!$(t)}function Kt(t){return Jt(t)?Mt(t):Ht(t)}var Qt=function(t,e){return function(r,n){if(null==r)return r;if(!Jt(r))return t(r,n);for(var o=r.length,i=e?o:-1,u=Object(r);(e?i--:++i<o)&&!1!==n(u[i],i,u););return r}}((function(t,e){return t&&vt(t,e,Kt)})),Xt=Qt;function Yt(t){return t}function Zt(t,e){var r;return(o(t)?ht:Xt)(t,"function"==typeof(r=e)?r:Yt)}function te(t){return"[object String]"===Object.prototype.toString.call(t)}function ee(t){return!(!te(t)||""===t)}function re(t){return"[object Array]"===Object.prototype.toString.call(t)}function ne(t){return"[object Object]"===Object.prototype.toString.call(t)}function oe(t){return t!=t}function ie(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(ne(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!te(t)||""!==t)}(t)||(!!function(t){return!!re(t)&&0===t.length}(t)||!!oe(t)))))}function ue(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"anyone";if(!ee(t))return!1;if("anyone"!==r&&"all"!==r)return!1;if(te(e)){if(!ee(e))return!1;e=[e]}if(!re(n=e)||0===n.length||1===n.length&&ie(n[0]))return!1;var n;let o=!1;if(Zt(e,(function(t){ee(t)||(o=!0)})),o)return!1;let i=0;return Zt(e,(function(e){-1!==function(t,e){return t.indexOf(e)}(t,e)&&i++})),"anyone"===r?i>0:"all"===r&&i===e.length}var ce=/\s/;var ae=/^\s+/;function le(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&ce.test(t.charAt(e)););return e}(t)+1).replace(ae,""):t}var fe=NaN,se=/^[-+]0x[0-9a-f]+$/i,pe=/^0b[01]+$/i,ye=/^0o[0-7]+$/i,be=parseInt;function he(t){if("number"==typeof t)return t;if(m(t))return fe;if(O(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=O(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=le(t);var r=pe.test(t);return r||ye.test(t)?be(t.slice(2),r?2:8):se.test(t)?fe:+t}var ge=1/0,ve=17976931348623157e292;function de(t){return t?(t=he(t))===ge||t===-ge?(t<0?-1:1)*ve:t==t?t:0:0===t?t:0}function je(t){var e=de(t),r=e%1;return e==e?r?e-r:e:0}function me(t){let e=!1;if(ee(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(oe(t))return!1;e=!0}return e}function we(t){if(!me(t))return 0;return de(t)}function _e(t){return!!me(t)&&(t=we(t),"number"==typeof(e=t)&&e==je(e));var e}var Oe=c.isFinite,Pe=Math.min;var Se=function(t){var e=Math[t];return function(t,r){if(t=he(t),(r=null==r?0:Pe(je(r),292))&&Oe(t)){var n=(ft(t)+"e").split("e");return+((n=(ft(e(n[0]+"e"+(+n[1]+r)))+"e").split("e"))[0]+"e"+(+n[1]-r))}return e(t)}}("round"),xe=Se;function ke(t){if(!me(t))return 0;t=we(t);let e=xe(t);return"0"===String(e)?0:e}function $e(t){if(!_e(t))return!1;return ke(t)>0}function Te(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function Ae(t){let e,r=Object.prototype.toString.call(t);if(e="[object Promise]"===r,e)return!0;if("[object Function]"!==r)return!1;try{e="function"!=typeof t.subscribe&&"function"==typeof t.then}catch(t){}return e}function Ee(){let t,e,r=new Promise((function(){t=arguments[0],e=arguments[1]}));return r.resolve=t,r.reject=e,r}function Ne(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Fe(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ne(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ne(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}return function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!ee(e))throw new Error("invalid site");let n=bt(r,"params",{}),o=bt(r,"keyGlobal","");ee(o)||(o="___params___");let i=bt(r,"timeWaitAnimation");$e(i)||(i=0);let u=bt(r,"defToken","");ee(u)||(u="sys");let c=bt(r,"apiName","");ee(c)||(c="api");let a=bt(r,"apiNameForVerify","");ee(a)||(a="getUserByToken");let l=bt(r,"retry");var f;_e(f=l)&&ke(f)>=0||(l=3);let s=window.location.origin,p=window.location.origin+window.location.pathname,y=s,b=p;if(ee(window.location.port)){let t=`:${window.location.port}`;y=y.replace(t,""),b=b.replace(t,"")}window[o]=Fe(Fe({},n),{},{site:e,origin:s,originNoPort:y,base:p,baseNoPort:b});let h=()=>{let t=new URLSearchParams(window.location.search),e={};return t.forEach(((t,r)=>{e[r]=t})),e},g=()=>bt(h(),"token",""),v=()=>{let t="";return ee(t)||(t=g()),ee(t)||(t=localStorage.getItem(`${e}:userToken`)),t},d=t=>bt(window,`${o}.${t}`,""),j=t=>{let e=v(),r=bt(window,`${o}.origin`,""),n=bt(window,`${o}.originNoPort`,""),i=bt(window,`${o}.base`,""),u=bt(window,`${o}.baseNoPort`,""),c=d(t);return c=c.replace("{token}",e),c=c.replace("{origin}",r),c=c.replace("{originNoPort}",n),c=c.replace("{base}",i),c=c.replace("{baseNoPort}",u),c},m=async e=>{let r,n=null,o=`${d("base")}${c}/${e}`;return await t({method:"GET",url:o}).then((t=>{r=t.data})).catch((t=>{n=t.toString()})),null!==n?Promise.reject(n):r},w={parseUrl:h,getTokenFromUrl:g,getToken:v,getValue:d,getUrl:j,getApi:m,login:async function(){let t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=bt(r,"afterGetUser"),o=bt(r,"afterLogin"),c=bt(r,"loginError"),l=bt(r,"loginSuccess"),f=d("site");await async function(){let t=null;if(await function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;me(t)||(t=10);let e=Ee();return setTimeout((function(){e.resolve()}),t),e}(i),!ee(f))throw console.log("site",f),new Error("invalid site");let e="";if(ee(e)||(e=g()),ee(e)||(e=localStorage.getItem(`${f}:userToken`)),location&&ue(location.href,"localhost")){if(ee(e)||(e=u),"error"===e)return t={text:"登入時無效令牌",msg:"invalid token"},Promise.reject(t)}else if(!ee(e))return t={text:"登入時無效令牌",msg:"invalid token"},Promise.reject(t);let r=await m(`${a}?token=${e}`).catch((e=>{t={text:"登入時無法連線",msg:e}}));if(null!==t)return Promise.reject(t);if("error"===bt(r,"state"))return t={text:"登入時驗證失敗",msg:bt(r,"msg")},Promise.reject(t);let o=bt(r,"msg");if(!function(t){if(ne(t)){for(let e in t)return!0;return!1}return!1}(o))return console.log("data",r),t={text:"登入時無法取得使用者資訊",msg:"invalid user"},Promise.reject(t);if(Te(n)){let t=n(o);Ae(t)&&(t=await t)}return{token:e,user:o}}().then((r=>{t=!0,e=r,localStorage.setItem(`${f}:userToken`,r.token)})).catch((r=>{t=!1,e=r,localStorage.setItem(`${f}:userToken`,"")}));let s={state:t,data:e};if(Te(o)){let t=o(s);Ae(t)&&(t=await t)}if(t){if(Te(l)){let t=l(e);Ae(t)&&(t=await t)}}else if(Te(c)){let t=c(e);Ae(t)&&(t=await t)}return s},detect:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=bt(e,"timePeriod");$e(r)||(r=2e3),r=ke(r);let n=bt(e,"procCheckToken"),o=bt(e,"procLogout"),i=d("site"),u=j("checkToken"),c=async()=>{let e=null,r=await t({method:"GET",url:u}).catch((t=>{e={text:"驗證令牌時遭遇錯誤",msg:t}}));return null!==e?Promise.reject(e):r},a=async()=>{let t=function(t){if(!Te(t))throw new Error("fn is not a function");return function(){let e=Ee(),r=null,n=null;try{r=t.apply(this,arguments)}catch(t){n=t}return null!==n?e.resolve({state:"error",msg:n}):Ae(r)?r.then((t=>{e.resolve({state:"success",msg:t})})).catch((t=>{"cancelled"===bt(t,"reason")?e.resolve({state:"cancelled",msg:""}):e.resolve({state:"error",msg:t})})):e.resolve({state:"success",msg:r}),e}}(c),e=await t(),r=0;for(;"error"===e.state&&(r+=1,!(r>l));)console.log(`retry n=${r}`),e=await t();return"success"===e.state?e.msg:Promise.reject(e.msg)},f=!1;let s=setInterval((()=>{(async function(){let t=null;if(f)return;if(f=!0,!ee(localStorage.getItem(`${i}:userToken`)))return t={text:"令牌已清除",msg:"invalid token"},Promise.reject(t);let e=await a().catch((e=>{t=e}));if(null!==t)return Promise.reject(t);if(Te(n)){let r=n(e);Ae(r)&&(r=await r),r||(t={text:"驗證令牌失敗",msg:e})}if(null!==t)return Promise.reject(t);f=!1})().catch((t=>{clearInterval(s),Te(o)&&o(t)}))}),r);return null},logout:async function(){let e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=bt(n,"procLogout"),i=bt(n,"afterLogout"),u=bt(n,"logoutError"),c=bt(n,"logoutSuccess"),a=d("site");await async function(){let e=null,r=v();if(!ee(r))return e={text:"無法取得登出用token",msg:"invalid token"},Promise.reject(e);let n=j("logOut");if(!ee(n))return e={text:"無法取得登出用設定資訊",msg:"invalid urlLogOut"},Promise.reject(e);let i=await t({method:"GET",url:n}).catch((t=>{e={text:"登出時遭遇錯誤",msg:t}}));if(null!==e)return Promise.reject(e);if(Te(o)){let t=o(i);Ae(t)&&(t=await t),t||(e={text:"登出失敗",msg:i})}return null!==e?Promise.reject(e):{token:r}}().then((t=>{e=!0,r=t})).catch((t=>{e=!1,r=t}));let l={state:e,data:r};if(localStorage.setItem(`${a}:userToken`,""),Te(i)){let t=i(l);Ae(t)&&(t=await t)}if(e){if(Te(c)){let t=c(r);Ae(t)&&(t=await t)}}else if(Te(u)){let t=u(r);Ae(t)&&(t=await t)}return l}};return w}}));
//# sourceMappingURL=w-ui-loginout.umd.js.map
